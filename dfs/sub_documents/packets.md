# Packet format

In the payload, if it contains the file name and the binary file at the same time, this 2 information are separated by character `||`.

| packetName         | payloadSize | Payload                                           | Purpose                                                                                                                                                         | From -> To                                                                                        |
| ------------------ | ----------- | ------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| Heartbeat          | 0           | []                                                | Check health status of nodes (heartbeat)                                                                                                                        | Current Master -> Data node<br>Current Master -> Backup Master<br>Backup Master -> Current Master |
| HeartbeatAck       | n           | `<node_id>`                                       | Heartbeat ACK                                                                                                                                                   | Data node -> Current Master<br>Current Master -> Backup Master<br>Backup Master -> Current Master |
| RequestSendReplica | n           | `<Data Node IP>` `<port>` `<file name>`           | Current Master requests Data node to send a replica of a specific file to another Data node                                                                     | Current Master -> Data node                                                                       |
| SendReplica        | n           | `<file name>` `\|\|` `<binary>`                   | Transmit file replica                                                                                                                                           | Data node -> Data node                                                                            |
| SendReplicaAck     | n           | `<file name>`                                     | 2 Data nodes notify the Master the [**_Replication process_**](#replication) of specific file is done (ACK of replication)                                      | Data node -> Current Master                                                                       |
| AskIP              | 2           | `<port>`                                          | Ask the IP of the current Master node                                                                                                                           | Payload Client -> DNS                                                                             |
| AskIPAck           | n           | `<Master address's IP>` `<Master address's port>` | DNS responses the current Master IP. If Master IP is available, 6 consecutive bytes in payload indicate the IP and port of Master. Otherwise, payload is empty. | DNS -> Client                                                                                     |
| RequestFromClient  | n           | `<READ/WRITE>` `<Client's port>` `<file name>`    | Client asks to read/write specific file                                                                                                                         | Client -> Current Master<br>Client -> Data node                                                   |
| ResponseNodeIp     | n           | `<Data Node IP>` `<port>`                         | Master responses which Data node is keeping the file replica/ready to receive file                                                                              | Current Master -> Client                                                                          |
| ClientUpload       | n           | `<Client's port>` `<file name>` `\|\|` `<binary>` | Client writes (uploads) file                                                                                                                                    | Client -> Data node                                                                               |
| DataNodeSendData   | n           | `<file name>` `\|\|` `<binary>`                   | Data node response file binary                                                                                                                                  | Data node -> Client                                                                               |
| ClientRequestAck   | n           | `<READ/WRITE>` <Data node's port> `<filename>`    | Data node notifies the Master the reading/writing process from client is done                                                                                   | Data node -> Current Master                                                                       |
| StateSync          | n           | `<state>`                                         | Current Master node synchronizes its state with the backup Master                                                                                               | Current Master -> Backup Master                                                                   |
| StateSyncAck       | 0           | []                                                | ACK of state synchronization                                                                                                                                    | Backup Master -> Current Master                                                                   |
| Notify             | n           | `<role>` `<IP>` `<port>`                          | Either of 3 scenarios:<br>i. new Master node notifies to DNS<br>ii. new Data node notifies to current Master <br>iii. new Master notifies to current Master     | Master -> DNS<br>Master -> Master<br>Data node -> Master                                          |
| ClientUploadAck    | 0           | []                                                | ClientUpload ACK                                                                                                                                                | Master/Data node -> Client                                                                        |
